<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Special Participation A Explorer</title>
    <link rel="icon" type="image/png" href="img/neuralnet.png" />
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-inner">
        <img src="img/neuralnet.png" alt="Neural network illustration" class="header-logo" />
        <div>
          <h1>Special Participation A Explorer</h1>
          <p class="subtitle">
            Curated views of EECS 182 "special participation A" posts where students used LLMs to evaluate homework problems.
          </p>
        </div>
        <div class="appearance-control">
          <span class="appearance-label">Appearance</span>
          <div class="appearance-buttons" role="radiogroup" aria-label="Appearance">
            <button type="button" class="appearance-btn is-active" data-mode="auto" aria-pressed="true">
              Auto
            </button>
            <button type="button" class="appearance-btn" data-mode="light" aria-pressed="false">
              Light
            </button>
            <button type="button" class="appearance-btn" data-mode="dark" aria-pressed="false">
              Dark
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="page-main">
      <button
        id="filters-toggle"
        class="filters-toggle-button"
        type="button"
        aria-expanded="true"
        aria-controls="controls"
      >
        Hide filters
      </button>

      <div class="main-layout">
        <aside id="controls" class="panel filters-panel" aria-label="Post filters">
          <h2>üîç Explore Posts</h2>
          <div class="filters" aria-label="Post filters">
            <label class="search-label">
              <span>Search</span>
              <input
                id="search-text"
                type="search"
                placeholder="Search posts, authors, models..."
              />
              <span class="search-hint">
                Try: <code>author:John</code> <code>model:Claude</code> <code>hw:HW5</code>
              </span>
            </label>

            <label>
              <span>Contributor</span>
              <select id="filter-author"></select>
            </label>

            <label>
              <span>Homework</span>
              <select id="filter-homework"></select>
            </label>

            <label>
              <span>Model</span>
              <select id="filter-model"></select>
            </label>

            <label>
              <span>Sort by</span>
              <select id="sort-order">
                <option value="newest">Newest first</option>
                <option value="oldest">Oldest first</option>
                <option value="homework">Homework (ascending)</option>
                <option value="model">Model (A-Z)</option>
                <option value="author">Contributor (A-Z)</option>
              </select>
            </label>
          </div>
        </aside>

        <div class="content-column">
          <nav class="view-tabs" aria-label="Views" role="tablist">
            <button
              id="tab-matrix"
              class="view-tab is-active"
              type="button"
              role="tab"
              aria-selected="true"
              aria-controls="matrix-view"
              data-view="matrix"
            >
              üìã Matrix View
            </button>
            <button
              id="tab-overview"
              class="view-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="overview"
              data-view="overview"
            >
              üìù Threads
            </button>
            <button
              id="tab-homework"
              class="view-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="homework-insights"
              data-view="homework"
            >
              üìö Homework Insights
            </button>
            <button
              id="tab-models"
              class="view-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="model-insights"
              data-view="models"
            >
              ü§ñ Model Insights
            </button>
            <button
              id="tab-judge"
              class="view-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="judge-view"
              data-view="judge"
            >
              üìä Performance Analyzer
            </button>
          </nav>

          <section
            id="overview"
            class="panel view-section"
            data-view="overview"
            role="tabpanel"
            aria-labelledby="tab-overview"
            hidden
          >
            <h2>üìù Threads</h2>
            <p>
              Explore how students used LLMs to solve EECS 182 homework problems. 
              Each post documents a student's experience with a specific model on a homework assignment.
            </p>
            
            <div class="analyzer-panel" id="analyzer-panel">
              <div class="analyzer-header">
                <div class="analyzer-title-row">
                  <h3>üìä Performance Scores</h3>
                  <div class="analyzer-status-row">
                    <select id="overview-model-select" class="analyzer-model-select">
                      <option value="">Select scoring model...</option>
                      <option value="Llama-3.2-1B-Instruct-q4f16_1-MLC">Llama 3.2 1B (fastest)</option>
                      <option value="Llama-3.2-3B-Instruct-q4f16_1-MLC">Llama 3.2 3B (balanced)</option>
                      <option value="Qwen2.5-1.5B-Instruct-q4f16_1-MLC">Qwen 2.5 1.5B</option>
                    </select>
                    <span id="overview-analyzer-status" class="analyzer-status-badge">Not loaded</span>
                  </div>
                </div>
                <p class="small-muted">
                  Use an on-device LLM to score how well each AI model performed (1-5 scale) based on students' reports.
                  Click "Analyze" on any post, or analyze all at once.
                </p>
                <div id="overview-loading" class="analyzer-loading">
                  <div class="analyzer-loading-inner">
                    <div class="analyzer-loading-spinner"></div>
                    <span id="overview-loading-text" class="analyzer-loading-text">Loading model...</span>
                    <div class="analyzer-progress-bar">
                      <div id="overview-progress-fill" class="analyzer-progress-fill"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="analyzer-actions">
                <button id="analyze-all-btn" class="analyzer-btn analyzer-btn-primary" disabled>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                  Analyze All Posts
                </button>
                <button id="clear-scores-btn" class="analyzer-btn analyzer-btn-secondary" disabled>
                  Clear Scores
                </button>
                <span id="analyze-progress" class="analyzer-progress-text"></span>
              </div>
              <div id="score-summary" class="score-summary"></div>
            </div>
          </section>

          <section
            id="explore"
            class="panel view-section"
            data-view="overview"
            aria-label="Explore posts"
            hidden
          >
            <div id="summary-bar" class="summary-bar"></div>
            <div id="posts-list" class="posts-list" aria-live="polite"></div>
            <div id="error-message" class="error-message" hidden></div>
          </section>

          <section
            id="homework-insights"
            class="panel view-section"
            data-view="homework"
            role="tabpanel"
            aria-labelledby="tab-homework"
            hidden
          >
            <div class="insights-header">
              <h2>üìö Homework Insights</h2>
              <p class="small-muted">
                AI-generated summaries analyzing how different models performed on each homework assignment. 
                Discover patterns, strengths, and areas where models struggled.
              </p>
            </div>
            <div id="homework-insights-body" class="insights-body"></div>
          </section>

          <section
            id="model-insights"
            class="panel view-section"
            data-view="models"
            role="tabpanel"
            aria-labelledby="tab-models"
            hidden
          >
            <div class="insights-header">
              <h2>ü§ñ Model Insights</h2>
              <p class="small-muted">
                AI-generated summaries of how each model performed across all homework assignments. 
                Compare strengths, weaknesses, and student sentiments for each AI model.
              </p>
            </div>
            <div id="model-insights-body" class="insights-body"></div>
          </section>

          <section
            id="judge-view"
            class="panel view-section"
            data-view="judge"
            role="tabpanel"
            aria-labelledby="tab-judge"
            hidden
          >
            <div class="judge-container">
              <header class="judge-header">
                <div class="judge-title-area">
                  <h2>üìä Model Performance Analyzer</h2>
                  <p class="small-muted">
                    Automatically score <strong>how well each AI model performed</strong> on homework assignments (1-5 scale), 
                    based on students' reports describing their accuracy, errors, and overall performance.
                  </p>
                </div>
                <div class="judge-controls">
                  <div class="judge-model-row">
                    <select id="judge-model-select" class="judge-select">
                      <option value="">Select scoring model...</option>
                      <option value="Llama-3.2-1B-Instruct-q4f16_1-MLC">Llama 3.2 1B (fastest)</option>
                      <option value="Llama-3.2-3B-Instruct-q4f16_1-MLC">Llama 3.2 3B (balanced)</option>
                      <option value="Qwen2.5-1.5B-Instruct-q4f16_1-MLC">Qwen 2.5 1.5B</option>
                    </select>
                    <div id="judge-status" class="judge-status">Select model to start</div>
                  </div>
                  <div id="judge-loading" class="judge-loading">
                    <div class="judge-loading-inner">
                      <div class="judge-loading-spinner"></div>
                      <span id="judge-loading-text" class="judge-loading-text">Loading model...</span>
                      <div class="judge-progress-bar">
                        <div id="judge-progress-fill" class="judge-progress-fill"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </header>

              <div class="judge-main-content">
                <div class="judge-actions">
                  <button id="judge-run-all" class="judge-btn judge-btn-primary" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Analyze All Reports
                  </button>
                  <button id="judge-clear" class="judge-btn judge-btn-secondary" disabled>
                    Clear Results
                  </button>
                  <div class="judge-progress-info">
                    <span id="judge-progress-text"></span>
                  </div>
                </div>

                <div class="judge-viz-controls">
                  <h3>üìà Visualization</h3>
                  <div class="judge-viz-tabs">
                    <button class="judge-viz-tab active" data-viz="by-homework">
                      üìä By Homework
                    </button>
                    <button class="judge-viz-tab" data-viz="by-model">
                      ü§ñ By Model
                    </button>
                    <button class="judge-viz-tab" data-viz="homework-holistic">
                      üìà Homework Holistic
                    </button>
                    <button class="judge-viz-tab" data-viz="model-holistic">
                      üìâ Model Holistic
                    </button>
                  </div>
                  
                  <div class="judge-viz-filter">
                    <label id="judge-filter-label">Select Homework:</label>
                    <select id="judge-filter-select">
                      <option value="">Loading...</option>
                    </select>
                  </div>
                </div>

                <div class="judge-chart-area">
                  <div id="judge-chart-container" class="judge-chart-container">
                    <div class="judge-chart-placeholder">
                      <div class="judge-chart-placeholder-icon">üìä</div>
                      <p>Load a model and run the judge to see visualizations</p>
                    </div>
                  </div>
                  <div id="judge-chart-legend" class="judge-chart-legend"></div>
                </div>

                <div class="judge-results-table-container">
                  <h3>üìù Detailed Results</h3>
                  <div id="judge-results-table" class="judge-results-table">
                    <p class="muted-text">No results yet. Run the judge to score reports.</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section
            id="matrix-view"
            class="panel view-section"
            data-view="matrix"
            role="tabpanel"
            aria-labelledby="tab-matrix"
          >
            <div class="matrix-header">
              <h2>üìã Contribution Matrix</h2>
              <p class="small-muted">
                A quick overview of which students evaluated which models on each homework.
                Each cell shows the author(s) who submitted a report for that combination.
              </p>
              <div class="matrix-controls">
                <button id="transpose-matrix-btn" class="matrix-transpose-btn" type="button">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="17 1 21 5 17 9"></polyline>
                    <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                    <polyline points="7 23 3 19 7 15"></polyline>
                    <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                  </svg>
                  Transpose
                </button>
              </div>
            </div>
            <div id="matrix-container" class="matrix-container"></div>
          </section>
        </div>
      </div>
    </main>

    <div id="post-modal-backdrop" class="post-modal-backdrop" hidden>
      <div
        id="post-modal"
        class="post-modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="post-modal-title"
      >
        <button
          id="post-modal-close"
          class="post-modal-close"
          type="button"
          aria-label="Close post"
        >
          √ó
        </button>
        <header class="post-modal-header">
          <h2 id="post-modal-title"></h2>
          <p id="post-modal-meta" class="post-modal-meta"></p>
          <div id="post-modal-badges" class="post-badges"></div>
          <div id="post-modal-files"></div>
        </header>
        <section class="post-modal-body">
          <pre id="post-modal-body" class="post-modal-text"></pre>
        </section>
        <section class="post-modal-qa">
          <div class="qa-header">
            <h4>Ask about this thread</h4>
            <span id="qa-status" class="qa-status"></span>
          </div>
          <div id="qa-messages" class="qa-messages"></div>
          <form id="qa-form" class="qa-form">
            <input
              type="text"
              id="qa-input"
              class="qa-input"
              placeholder="Ask a question about this thread..."
              autocomplete="off"
            />
            <button type="submit" id="qa-send" class="qa-send">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </form>
        </section>
      </div>
    </div>

    <footer class="site-footer">
      <p>
        Built by Etaash Patel, Jason Trinh, Kevin Tseng, and Justin Yang
      </p>
    </footer>

    <!-- Chat Assistant Widget -->
    <div id="chat-widget" class="chat-widget">
      <button id="chat-toggle" class="chat-toggle" aria-label="Toggle chat assistant">
        <svg class="chat-icon-open" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <svg class="chat-icon-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <div id="chat-panel" class="chat-panel" hidden>
        <header class="chat-header">
          <div class="chat-header-top">
            <div>
              <h3>üí¨ AI Assistant</h3>
              <p id="chat-status" class="chat-status">Select a model to start</p>
            </div>
            <button id="clear-chat" class="clear-chat-btn" type="button" title="Clear conversation">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
          <select id="model-select" class="model-select">
            <option value="">Select a model...</option>
            <option value="Llama-3.2-1B-Instruct-q4f16_1-MLC">Llama 3.2 1B (fastest)</option>
            <option value="Llama-3.2-3B-Instruct-q4f16_1-MLC">Llama 3.2 3B (balanced)</option>
            <option value="SmolLM2-1.7B-Instruct-q4f16_1-MLC">SmolLM2 1.7B</option>
            <option value="Qwen2.5-1.5B-Instruct-q4f16_1-MLC">Qwen 2.5 1.5B</option>
          </select>
          <div class="rag-controls">
            <label class="rag-toggle-label">
              <input type="checkbox" id="rag-toggle" class="rag-toggle-input" />
              <span class="rag-toggle-switch"></span>
              <span class="rag-toggle-text">RAG</span>
            </label>
            <span id="rag-status" class="rag-status">RAG disabled</span>
          </div>
        </header>

        <div id="chat-messages" class="chat-messages">
          <div class="chat-message assistant">
            <div class="message-content">
              <p>Hi! Select a model from the dropdown above to get started. The model will run entirely in your browser using WebGPU.</p>
            </div>
          </div>
        </div>

        <div id="chat-loading" class="chat-loading" hidden>
          <div class="loading-spinner"></div>
          <span id="loading-text">Downloading model...</span>
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
          </div>
        </div>

        <form id="chat-form" class="chat-form">
          <input
            type="text"
            id="chat-input"
            class="chat-input"
            placeholder="Type a message..."
            autocomplete="off"
            disabled
          />
          <button type="submit" id="chat-send" class="chat-send" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </form>
      </div>
    </div>

    <script type="module" src="src/main.js"></script>
    <script type="module" src="src/chat.js"></script>
    <script type="module" src="src/judge.js"></script>
  </body>
</html>