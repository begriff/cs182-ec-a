<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Special Participation A Explorer</title>
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-inner">
        <div>
          <h1>Special Participation A Explorer</h1>
          <p class="subtitle">
            Curated views of EECS 182 "special participation A" posts where students used LLMs to evaluate homework problems.
          </p>
        </div>
        <div class="appearance-control">
          <span class="appearance-label">Appearance</span>
          <div class="appearance-buttons" role="radiogroup" aria-label="Appearance">
            <button type="button" class="appearance-btn is-active" data-mode="auto" aria-pressed="true">
              Auto
            </button>
            <button type="button" class="appearance-btn" data-mode="light" aria-pressed="false">
              Light
            </button>
            <button type="button" class="appearance-btn" data-mode="dark" aria-pressed="false">
              Dark
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="page-main">
      <button
        id="filters-toggle"
        class="filters-toggle-button"
        type="button"
        aria-expanded="true"
        aria-controls="controls"
      >
        Hide filters
      </button>

      <div class="main-layout">
        <aside id="controls" class="panel filters-panel" aria-label="Post filters">
          <h2>Explore posts</h2>
          <div class="filters" aria-label="Post filters">
            <label>
              <span>Homework</span>
              <select id="filter-homework"></select>
            </label>

            <label>
              <span>Model</span>
              <select id="filter-model"></select>
            </label>

            <label>
              <span>Primary focus</span>
              <select id="filter-focus"></select>
            </label>

            <label>
              <span>Actionability</span>
              <select id="filter-actionability"></select>
            </label>

            <label class="search-label">
              <span>Search</span>
              <input
                id="search-text"
                type="search"
                placeholder="Search title or body text..."
              />
            </label>

            <label>
              <span>Sort by</span>
              <select id="sort-order">
                <option value="newest">Newest first</option>
                <option value="oldest">Oldest first</option>
                <option value="depth">Depth (high → low)</option>
                <option value="actionability">Actionability (high → low)</option>
              </select>
            </label>
          </div>
        </aside>

        <div class="content-column">
          <nav class="view-tabs" aria-label="Views" role="tablist">
            <button
              id="tab-overview"
              class="view-tab is-active"
              type="button"
              role="tab"
              aria-selected="true"
              aria-controls="overview"
              data-view="overview"
            >
              Overview
            </button>
            <button
              id="tab-homework"
              class="view-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="homework-insights"
              data-view="homework"
            >
              Homework insights
            </button>
            <button
              id="tab-models"
              class="view-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="model-insights"
              data-view="models"
            >
              Model insights
            </button>
          </nav>

          <section
            id="overview"
            class="panel view-section"
            data-view="overview"
            role="tabpanel"
            aria-labelledby="tab-overview"
          >
            <h2>Overview</h2>
            <p>
              This tool reads the exported Ed Discussion threads in
              <code>thread_util/threads.json</code>, annotates each post with a small
              set of hand-designed metrics, and lets you interactively filter and
              explore how students used large language models on different
              homeworks.
            </p>
            <div class="overview-grid">
              <div>
                <h3>Data</h3>
                <ul>
                  <li>One row per top-level Ed thread that matched "special participation A".</li>
                  <li>Includes title, plain-text body, author, timestamps, and category.</li>
                  <li>Replies are not included beyond simple counts.</li>
                </ul>
              </div>
              <div>
                <h3>Metrics (summary)</h3>
                <ul>
                  <li><strong>Homework</strong>: which HW the post is about (e.g., HW6).</li>
                  <li><strong>Model</strong>: which LLM or tool was evaluated (Kimi, Claude, GPT-5.x, etc.).</li>
                  <li><strong>Primary focus</strong>: model performance, assignment feedback, prompting, or reflection.</li>
                  <li><strong>Depth</strong>: low / medium / high, based on length and language.</li>
                  <li><strong>Actionability</strong>: low / medium / high, based on presence of concrete suggestions.</li>
                </ul>
                <p class="small-muted">
                  See <code>METRICS_DESIGN.md</code> for the exact heuristics.
                </p>
              </div>
            </div>
          </section>

          <section
            id="explore"
            class="panel view-section"
            data-view="overview"
            aria-label="Explore posts"
          >
            <div id="summary-bar" class="summary-bar"></div>
            <div id="posts-list" class="posts-list" aria-live="polite"></div>
            <div id="error-message" class="error-message" hidden></div>
          </section>

          <section
            id="homework-insights"
            class="panel view-section"
            data-view="homework"
            role="tabpanel"
            aria-labelledby="tab-homework"
            hidden
          >
            <h2>Homework insights</h2>
            <p class="small-muted">
              High-level summaries of how different models performed on each homework. This
              section is a template; a separate script populates the metrics.
            </p>
            <div class="insights-grid">
              <article class="insight-card">
                <h3>Homework-level insights</h3>
                <p>
                  Placeholder for narrative annotations and explanations of how different models
                  performed on each homework.
                </p>
                <div id="homework-insights-body" class="insights-body"></div>
              </article>
            </div>
          </section>

          <section
            id="model-insights"
            class="panel view-section"
            data-view="models"
            role="tabpanel"
            aria-labelledby="tab-models"
            hidden
          >
            <h2>Model insights</h2>
            <p class="small-muted">
              Summaries of how each model performed across all homeworks. This section is a
              template; a separate script populates the metrics.
            </p>
            <div class="insights-grid">
              <article class="insight-card">
                <h3>Model-level insights</h3>
                <p>
                  Placeholder for narrative annotations and explanations of how each model
                  performed overall across homeworks.
                </p>
                <div id="model-insights-body" class="insights-body"></div>
              </article>
            </div>
          </section>
        </div>
      </div>
    </main>

    <div id="post-modal-backdrop" class="post-modal-backdrop" hidden>
      <div
        id="post-modal"
        class="post-modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="post-modal-title"
      >
        <button
          id="post-modal-close"
          class="post-modal-close"
          type="button"
          aria-label="Close post"
        >
          ×
        </button>
        <header class="post-modal-header">
          <h2 id="post-modal-title"></h2>
          <p id="post-modal-meta" class="post-modal-meta"></p>
          <div id="post-modal-badges" class="post-badges"></div>
          <div id="post-modal-files"></div>
        </header>
        <section class="post-modal-body">
          <pre id="post-modal-body" class="post-modal-text"></pre>
        </section>
        <section class="post-modal-qa">
          <div class="qa-header">
            <h4>Ask about this thread</h4>
            <span id="qa-status" class="qa-status"></span>
          </div>
          <div id="qa-messages" class="qa-messages"></div>
          <form id="qa-form" class="qa-form">
            <input
              type="text"
              id="qa-input"
              class="qa-input"
              placeholder="Ask a question about this thread..."
              autocomplete="off"
            />
            <button type="submit" id="qa-send" class="qa-send">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </form>
        </section>
      </div>
    </div>

    <footer class="site-footer">
      <p>
        Built as a lightweight, static explorer for EECS 182 special participation posts.
        Data never leaves your machine.
      </p>
    </footer>

    <!-- Chat Assistant Widget -->
    <div id="chat-widget" class="chat-widget">
      <button id="chat-toggle" class="chat-toggle" aria-label="Toggle chat assistant">
        <svg class="chat-icon-open" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <svg class="chat-icon-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <div id="chat-panel" class="chat-panel" hidden>
        <header class="chat-header">
          <div class="chat-header-top">
            <div>
              <h3>AI Assistant</h3>
              <p id="chat-status" class="chat-status">Loading model...</p>
            </div>
            <button id="clear-chat" class="clear-chat-btn" type="button" title="Clear conversation">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
          <select id="model-select" class="model-select">
            <option value="">Select a model...</option>
            <option value="Llama-3.2-1B-Instruct-q4f16_1-MLC">Llama 3.2 1B (fastest)</option>
            <option value="Llama-3.2-3B-Instruct-q4f16_1-MLC">Llama 3.2 3B (balanced)</option>
            <option value="SmolLM2-1.7B-Instruct-q4f16_1-MLC">SmolLM2 1.7B</option>
            <option value="Qwen2.5-1.5B-Instruct-q4f16_1-MLC">Qwen 2.5 1.5B</option>
          </select>
          <div class="rag-controls">
            <label class="rag-toggle-label">
              <input type="checkbox" id="rag-toggle" class="rag-toggle-input" />
              <span class="rag-toggle-switch"></span>
              <span class="rag-toggle-text">RAG</span>
            </label>
            <span id="rag-status" class="rag-status">RAG disabled</span>
          </div>
        </header>

        <div id="chat-messages" class="chat-messages">
          <div class="chat-message assistant">
            <p>Hi! Select a model from the dropdown above to get started. The model will run entirely in your browser using WebGPU.</p>
          </div>
        </div>

        <div id="chat-loading" class="chat-loading" hidden>
          <div class="loading-spinner"></div>
          <span id="loading-text">Downloading model...</span>
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
          </div>
        </div>

        <form id="chat-form" class="chat-form">
          <input
            type="text"
            id="chat-input"
            class="chat-input"
            placeholder="Type a message..."
            autocomplete="off"
            disabled
          />
          <button type="submit" id="chat-send" class="chat-send" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </form>
      </div>
    </div>

    <script type="module" src="src/main.js"></script>
    <script type="module" src="src/chat.js"></script>
  </body>
</html>
